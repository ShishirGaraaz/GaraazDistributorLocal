{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Desktop\\\\Work\\\\garaaz-distributor\\\\src\\\\containers\\\\OrderList\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { useIntl } from 'react-intl';\nimport messages from './messages';\nimport { Badge, Menu, MenuButton, MenuList, MenuItem, Button, Center } from '@chakra-ui/react';\nimport TableTop from '../../components/TableTop';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { getAllOrders, setAllOrders, setTotalCount } from './actions';\nimport moment from 'moment';\nimport toast from 'react-hot-toast';\nimport DynamicTable from '../../components/DynamicTable';\nimport { setBranches, getBranchList } from '../BranchList/actions';\nimport enums from '../../utils/enums';\nimport { FiMoreVertical } from 'react-icons/fi';\nimport OrderDetails from '../OrderDetails';\nimport { Switch, Route, useRouteMatch, useHistory } from 'react-router-dom';\nimport stringifyArray from '../../utils/stringifyArray';\nimport withToast from '../../HOCs/withToast';\nimport OrderOverview from '../OrderDetails/OrderOverView';\nimport RequestOrder from '../OrderDetails/RequestOrder';\nimport getMoneyFormat from '../../utils/getMoneyFormat';\nimport downloadExcel from '../../utils/downloadExcel';\nimport { selectGlobalState } from '../../globalSlice';\nimport { devToolsEnhancer } from '@reduxjs/toolkit/dist/devtoolsExtension';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst OrderList = _ref => {\n  _s();\n\n  let {\n    notification\n  } = _ref;\n  const intl = useIntl();\n  const [tableData, setTableData] = useState([]);\n  const [orderStatus, setOrderStatus] = useState([]);\n  const [branchValue, setBranchValue] = useState([]);\n  const [workshopValue, setWorkshopValue] = useState([]);\n  const [dates, setDates] = useState({\n    startDate: '',\n    endDate: ''\n  });\n  const [orderIds, setOrdIds] = useState('');\n  const auth = useSelector(state => state.auth);\n  const {\n    orders,\n    totalCount\n  } = useSelector(state => state.orderList);\n  const dispatcher = useDispatch();\n  const [isLoading, setIsLoading] = useState(false);\n  const {\n    url,\n    path\n  } = useRouteMatch();\n  const history = useHistory();\n  const [pageCount, setPageCount] = useState(0);\n  const {\n    branches,\n    workshops\n  } = useSelector(selectGlobalState);\n\n  const fetchAllOrders = params => {\n    (async () => {\n      setIsLoading(true);\n\n      try {\n        var _response$totalCount, _response$totalCount2;\n\n        const response = await getAllOrders(auth, params);\n        dispatcher(setAllOrders(response === null || response === void 0 ? void 0 : response.data));\n        params.limit = (params === null || params === void 0 ? void 0 : params.limit) ? params === null || params === void 0 ? void 0 : params.limit : 10;\n        setPageCount(Math.ceil((response === null || response === void 0 ? void 0 : (_response$totalCount = response.totalCount) === null || _response$totalCount === void 0 ? void 0 : _response$totalCount.count) / (params === null || params === void 0 ? void 0 : params.limit)));\n        dispatcher(setTotalCount(response === null || response === void 0 ? void 0 : (_response$totalCount2 = response.totalCount) === null || _response$totalCount2 === void 0 ? void 0 : _response$totalCount2.count));\n        setIsLoading(false);\n      } catch (error) {\n        setIsLoading(false);\n\n        if (error.response) {\n          var _error$response$data$;\n\n          notification({\n            status: 'error',\n            description: (_error$response$data$ = error.response.data.message) !== null && _error$response$data$ !== void 0 ? _error$response$data$ : intl.formatMessage(messages.errorMessage)\n          });\n        }\n      }\n    })();\n  };\n  /*  useEffect(() => {\r\n     fetchAllOrders();\r\n   }, []); */\n\n\n  const columns = useMemo(() => [{\n    Header: intl.formatMessage(messages.date),\n    accessor: 'createdAt',\n    Cell: _ref2 => {\n      let {\n        value\n      } = _ref2;\n      return moment(value).format('DD/MM/YYYY');\n    }\n  }, {\n    Header: intl.formatMessage(messages.orderNo),\n    accessor: 'orderNo',\n    Cell: _ref3 => {\n      let {\n        value\n      } = _ref3;\n      return value;\n    }\n  }, {\n    Header: intl.formatMessage(messages.workshopCode),\n    accessor: row => {\n      var _row$workshop, _row$workshop$worksho;\n\n      return (_row$workshop = row.workshop) === null || _row$workshop === void 0 ? void 0 : (_row$workshop$worksho = _row$workshop.workshopcustomer[0]) === null || _row$workshop$worksho === void 0 ? void 0 : _row$workshop$worksho.code;\n    } //Cell: ({ value }) => value?.slice(0, 8),\n\n  }, {\n    Header: intl.formatMessage(messages.workshopName),\n    accessor: row => {\n      var _row$workshop2, _row$workshop2$worksh;\n\n      return (_row$workshop2 = row.workshop) === null || _row$workshop2 === void 0 ? void 0 : (_row$workshop2$worksh = _row$workshop2.workshopcustomer[0]) === null || _row$workshop2$worksh === void 0 ? void 0 : _row$workshop2$worksh.name;\n    }\n  }, {\n    Header: intl.formatMessage(messages.branchCode),\n    accessor: row => {\n      var _row$branch;\n\n      return (_row$branch = row.branch) === null || _row$branch === void 0 ? void 0 : _row$branch.branchCode;\n    }\n  }, {\n    Header: intl.formatMessage(messages.totalParts),\n    accessor: row => row.orderitems.length\n  }, {\n    Header: intl.formatMessage(messages.orderValue),\n    accessor: row =>\n    /*  row.orderitems.reduce(\r\n       (prevState, currentVal) => prevState + currentVal.price,\r\n       0,\r\n     ), */\n    row.orderitems.reduce((prev, curr) => prev + curr.price * curr.quantity, 0),\n    Cell: _ref4 => {\n      let {\n        value\n      } = _ref4;\n      return getMoneyFormat(value);\n    }\n  }, {\n    Header: intl.formatMessage(messages.paymentMode),\n    accessor: row => row.paymentOption\n  }, {\n    Header: intl.formatMessage(messages.orderStatus),\n    accessor: 'status',\n    Cell: _ref5 => {\n      let {\n        value\n      } = _ref5;\n      return value === enums.UPDATED ? /*#__PURE__*/_jsxDEV(Badge, {\n        colorScheme: \"yellow\",\n        children: intl.formatMessage(messages.updatedStatus)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 13\n      }, this) : value === enums.COMPLETED ? /*#__PURE__*/_jsxDEV(Badge, {\n        colorScheme: \"green\",\n        children: intl.formatMessage(messages.completedStatus)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(Badge, {\n        colorScheme: \"orange\",\n        children: value.replace(/_/g, ' ')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 13\n      }, this);\n    }\n  }, {\n    Header: intl.formatMessage(messages.actions),\n    accessor: row => row._id,\n    Cell: allData => {\n      const handleViewOrderDetails = () => {\n        const status = allData.row.original.status;\n\n        if (status === enums.COMPLETED || status === enums.STOCK_TRANSFER_COMPLETED || status === enums.STOCK_TRANSFER_PLACED || status === enums.CBO || status === enums.LOST_SALE) {\n          history.push(`${url}/${allData.value}/overview`);\n        } else if (status === enums.REQUEST_ORDER) {\n          history.push(`${url}/${allData.value}/request-order`);\n        } else if (status === enums.UPDATED) {\n          history.push(`${url}/${allData.value}/order-summary`);\n          /* history.push(`${url}/${allData.value}/request-order`); */\n        } else {\n          history.push(`${url}/${allData.value}`);\n        }\n      };\n\n      return /*#__PURE__*/_jsxDEV(Menu, {\n        children: [/*#__PURE__*/_jsxDEV(MenuButton, {\n          p: 0,\n          as: Button,\n          children: /*#__PURE__*/_jsxDEV(Center, {\n            children: /*#__PURE__*/_jsxDEV(FiMoreVertical, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(MenuList, {\n          onClick: handleViewOrderDetails,\n          children: /*#__PURE__*/_jsxDEV(MenuItem, {\n            children: \"View Detail\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 13\n      }, this);\n    }\n  }], []);\n\n  const handleSelectChange = (valueList, name) => {\n    const valueString = stringifyArray(valueList);\n    const statusString = stringifyArray(orderStatus);\n    const workshopString = stringifyArray(workshopValue);\n    const branchString = stringifyArray(branchValue);\n    const dateString = stringifyArray([dates.startDate, dates.endDate]);\n\n    if (name === enums.STATUS) {\n      setOrderStatus(valueList);\n      fetchAllOrders({\n        status: valueString,\n        order: orderIds,\n        workshop: workshopString,\n        branch: branchString,\n        date: dateString\n      });\n    } else if (name === enums.WORKSHOP) {\n      setWorkshopValue(valueList);\n      fetchAllOrders({\n        workshop: valueString,\n        order: orderIds,\n        branch: branchString,\n        status: statusString,\n        date: dateString\n      });\n    } else if (name === enums.BRANCH) {\n      setBranchValue(valueList);\n      fetchAllOrders({\n        branch: valueString,\n        order: orderIds,\n        workshop: workshopString,\n        status: statusString,\n        date: dateString\n      });\n    }\n  };\n\n  const handleSearchById = event => {\n    const idString = event.target.value;\n    const statusString = stringifyArray(orderStatus);\n    const workshopString = stringifyArray(workshopValue);\n    const branchString = stringifyArray(branchValue);\n    const dateString = stringifyArray([dates.startDate, dates.endDate]);\n    setOrdIds(idString);\n    fetchAllOrders({\n      status: statusString,\n      order: idString,\n      workshop: workshopString,\n      branch: branchString,\n      date: dateString\n    });\n  };\n  /* once workshop is implemented, this list will be replaced with fetched workshops */\n\n\n  const workshopOptions = workshops.map(workshop => ({\n    label: workshop === null || workshop === void 0 ? void 0 : workshop.name,\n    value: workshop === null || workshop === void 0 ? void 0 : workshop._id\n  }));\n  const branchOptions = branches.map(branch => ({\n    label: branch.branchName,\n    value: branch._id\n  }));\n\n  const checkIsBefore = (date1, date2) => {\n    return moment(date1).isBefore(date2);\n  };\n\n  const addToDate = (date, days) => {\n    return moment(date, 'YYYY-MM-DD').add(days, 'days').format('YYYY-MM-DD');\n  };\n\n  function subtractFromDate(date, days) {\n    return moment(date, 'YYYY-MM-DD').subtract(days, 'days').format('YYYY-MM-DD');\n  }\n\n  const handleExport = () => {\n    const refinedTableData = [...tableData].map(data => {\n      return {\n        'Date': data.date,\n        'Order No': data.orderNo,\n        'Workshop Code': data.workshopcustomer[0].code,\n        'Workshop Name': data.workshopcustomer[0].name,\n        'Branch Code': data.branchCode,\n        'Total Parts': data.orderitems.length(),\n        'Order Value': data.orderValue,\n        'Payment Mode': data.paymentOption,\n        'Order Status': data.orderStatus.join(',')\n      };\n    });\n    downloadExcel(refinedTableData, 'Branches.xlsx');\n  };\n\n  const handleDateChange = event => {\n    let dateString;\n    let {\n      value,\n      name\n    } = event.target;\n    const statusString = stringifyArray(orderStatus);\n    const workshopString = stringifyArray(workshopValue);\n    const branchString = stringifyArray(branchValue);\n\n    if (name === enums.STARTDATE && value) {\n      const endDate = dates.endDate ? dates.endDate : addToDate(value, 1);\n\n      if (!checkIsBefore(value, endDate)) {\n        notification({\n          status: 'error',\n          description: intl.formatMessage(messages.dateError)\n        });\n        return;\n      } else {\n        dateString = stringifyArray([value, endDate]);\n      }\n    }\n\n    if (name === enums.ENDDATE && value) {\n      const startDate = dates.startDate ? dates.startDate : subtractFromDate(value, 1);\n\n      if (checkIsBefore(value, startDate)) {\n        notification({\n          status: 'error',\n          description: intl.formatMessage(messages.dateError)\n        });\n      } else {\n        dateString = stringifyArray([startDate, value]);\n      }\n    }\n\n    setDates(prevState => ({ ...prevState,\n      [name]: value\n    }));\n    fetchAllOrders({\n      date: dateString,\n      status: statusString,\n      order: orderIds,\n      workshop: workshopString,\n      branch: branchString\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Switch, {\n    children: [/*#__PURE__*/_jsxDEV(Route, {\n      exact: true,\n      path: path,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(TableTop, {\n          onSearchOrderChange: handleSearchById,\n          onSelectChange: handleSelectChange,\n          orderStatus: orderStatus,\n          workshopOptions: workshopOptions,\n          branchOptions: branchOptions,\n          branchValue: branchValue,\n          workshopValue: workshopValue,\n          onDateChange: handleDateChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleExport,\n          variant: \"addition\",\n          size: \"md\",\n          ml: 4,\n          children: intl.formatMessage(messages.exportToExcel)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(DynamicTable, {\n          columns: columns,\n          data: [...orders],\n          fetchData: fetchAllOrders,\n          totalCount: totalCount,\n          controlledPageCount: pageCount,\n          loading: isLoading,\n          skipPageReset: true,\n          params: {\n            order: orderIds,\n            status: stringifyArray(orderStatus),\n            branch: stringifyArray(branchValue),\n            workshop: stringifyArray(workshopValue),\n            date: stringifyArray([dates.startDate, dates.endDate])\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Route, {\n      exact: true,\n      path: `${path}/:id/overview`,\n      children: /*#__PURE__*/_jsxDEV(OrderOverview, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Route, {\n      exact: true,\n      path: `${path}/:id/request-order`,\n      children: /*#__PURE__*/_jsxDEV(RequestOrder, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Route, {\n      path: `${path}/:id`,\n      children: /*#__PURE__*/_jsxDEV(OrderDetails, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 344,\n    columnNumber: 5\n  }, this);\n};\n\n_s(OrderList, \"Xnm6wLtNutygvW8kKEIVI2X5sHU=\", false, function () {\n  return [useIntl, useSelector, useSelector, useDispatch, useRouteMatch, useHistory, useSelector];\n});\n\n_c = OrderList;\nexport default _c2 = withToast(OrderList);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"OrderList\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["C:/Users/Acer/Desktop/Work/garaaz-distributor/src/containers/OrderList/index.js"],"names":["React","useState","useMemo","useEffect","useIntl","messages","Badge","Menu","MenuButton","MenuList","MenuItem","Button","Center","TableTop","useSelector","useDispatch","getAllOrders","setAllOrders","setTotalCount","moment","toast","DynamicTable","setBranches","getBranchList","enums","FiMoreVertical","OrderDetails","Switch","Route","useRouteMatch","useHistory","stringifyArray","withToast","OrderOverview","RequestOrder","getMoneyFormat","downloadExcel","selectGlobalState","devToolsEnhancer","OrderList","notification","intl","tableData","setTableData","orderStatus","setOrderStatus","branchValue","setBranchValue","workshopValue","setWorkshopValue","dates","setDates","startDate","endDate","orderIds","setOrdIds","auth","state","orders","totalCount","orderList","dispatcher","isLoading","setIsLoading","url","path","history","pageCount","setPageCount","branches","workshops","fetchAllOrders","params","response","data","limit","Math","ceil","count","error","status","description","message","formatMessage","errorMessage","columns","Header","date","accessor","Cell","value","format","orderNo","workshopCode","row","workshop","workshopcustomer","code","workshopName","name","branchCode","branch","totalParts","orderitems","length","orderValue","reduce","prev","curr","price","quantity","paymentMode","paymentOption","UPDATED","updatedStatus","COMPLETED","completedStatus","replace","actions","_id","allData","handleViewOrderDetails","original","STOCK_TRANSFER_COMPLETED","STOCK_TRANSFER_PLACED","CBO","LOST_SALE","push","REQUEST_ORDER","handleSelectChange","valueList","valueString","statusString","workshopString","branchString","dateString","STATUS","order","WORKSHOP","BRANCH","handleSearchById","event","idString","target","workshopOptions","map","label","branchOptions","branchName","checkIsBefore","date1","date2","isBefore","addToDate","days","add","subtractFromDate","subtract","handleExport","refinedTableData","join","handleDateChange","STARTDATE","dateError","ENDDATE","prevState","exportToExcel"],"mappings":"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","sourcesContent":["import React, { useState, useMemo, useEffect } from 'react';\r\nimport { useIntl } from 'react-intl';\r\n\r\nimport messages from './messages';\r\nimport {\r\n  Badge,\r\n  Menu,\r\n  MenuButton,\r\n  MenuList,\r\n  MenuItem,\r\n  Button,\r\n  Center,\r\n} from '@chakra-ui/react';\r\nimport TableTop from '../../components/TableTop';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { getAllOrders, setAllOrders, setTotalCount } from './actions';\r\nimport moment from 'moment';\r\nimport toast from 'react-hot-toast';\r\nimport DynamicTable from '../../components/DynamicTable';\r\nimport { setBranches, getBranchList } from '../BranchList/actions';\r\nimport enums from '../../utils/enums';\r\nimport { FiMoreVertical } from 'react-icons/fi';\r\nimport OrderDetails from '../OrderDetails';\r\nimport { Switch, Route, useRouteMatch, useHistory } from 'react-router-dom';\r\nimport stringifyArray from '../../utils/stringifyArray';\r\nimport withToast from '../../HOCs/withToast';\r\nimport OrderOverview from '../OrderDetails/OrderOverView';\r\nimport RequestOrder from '../OrderDetails/RequestOrder';\r\nimport getMoneyFormat from '../../utils/getMoneyFormat';\r\nimport downloadExcel from '../../utils/downloadExcel';\r\nimport {selectGlobalState} from '../../globalSlice'; \r\nimport { devToolsEnhancer } from '@reduxjs/toolkit/dist/devtoolsExtension';\r\n\r\n\r\nconst OrderList = ({ notification }) => {\r\n  const intl = useIntl();\r\n  const [tableData, setTableData] = useState([]);\r\n  const [orderStatus, setOrderStatus] = useState([]);\r\n  const [branchValue, setBranchValue] = useState([]);\r\n  const [workshopValue, setWorkshopValue] = useState([]);\r\n  const [dates, setDates] = useState({ startDate: '', endDate: '' });\r\n  const [orderIds, setOrdIds] = useState('');\r\n  const auth = useSelector((state) => state.auth);\r\n  const { orders, totalCount } = useSelector((state) => state.orderList);\r\n  const dispatcher = useDispatch();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { url, path } = useRouteMatch();\r\n  const history = useHistory();\r\n  const [pageCount, setPageCount] = useState(0);\r\n  const { branches, workshops } = useSelector(selectGlobalState);\r\n\r\n\r\n\r\n  const fetchAllOrders = (params) => {\r\n    (async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const response = await getAllOrders(auth, params);\r\n\r\n        dispatcher(setAllOrders(response?.data));\r\n\r\n       params.limit = params?.limit? params?.limit : 10;\r\n        setPageCount(Math.ceil(response?.totalCount?.count / params?.limit));\r\n\r\n        dispatcher(setTotalCount(response?.totalCount?.count));\r\n        setIsLoading(false);\r\n      } catch (error) {\r\n        setIsLoading(false);\r\n        if (error.response) {\r\n          notification({\r\n            status: 'error',\r\n            description:\r\n              error.response.data.message ??\r\n              intl.formatMessage(messages.errorMessage),\r\n          });\r\n        }\r\n      }\r\n    })();\r\n  };\r\n\r\n /*  useEffect(() => {\r\n    fetchAllOrders();\r\n  }, []); */\r\n\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        Header: intl.formatMessage(messages.date),\r\n        accessor: 'createdAt',\r\n        Cell: ({ value }) => moment(value).format('DD/MM/YYYY'),\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.orderNo),\r\n        accessor: 'orderNo',\r\n        Cell: ({ value }) => value,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.workshopCode),\r\n        accessor: (row) => row.workshop?.workshopcustomer[0]?.code,\r\n        //Cell: ({ value }) => value?.slice(0, 8),\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.workshopName),\r\n        accessor: (row) => row.workshop?.workshopcustomer[0]?.name,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.branchCode),\r\n        accessor: (row) => row.branch?.branchCode,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.totalParts),\r\n        accessor: (row) =>\r\n          row.orderitems.length\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.orderValue),\r\n        accessor: (row) =>\r\n         /*  row.orderitems.reduce(\r\n            (prevState, currentVal) => prevState + currentVal.price,\r\n            0,\r\n          ), */\r\n\r\n\r\n           row.orderitems.reduce(\r\n            (prev, curr) => prev + curr.price * curr.quantity,\r\n            0,\r\n          ),\r\n          Cell: ({ value }) => getMoneyFormat(value),\r\n\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.paymentMode),\r\n        accessor: (row) => row.paymentOption,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.orderStatus),\r\n        accessor: 'status',\r\n        Cell: ({ value }) => {\r\n          return value === enums.UPDATED ? (\r\n            <Badge colorScheme='yellow'>\r\n              {intl.formatMessage(messages.updatedStatus)}\r\n            </Badge>\r\n          ) : value === enums.COMPLETED ? (\r\n            <Badge colorScheme='green'>\r\n              {intl.formatMessage(messages.completedStatus)}\r\n            </Badge>\r\n          ) : (\r\n            <Badge colorScheme='orange'>{value.replace(/_/g, ' ')}</Badge>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.actions),\r\n        accessor: (row) => row._id,\r\n        Cell: (allData) => {\r\n          const handleViewOrderDetails = () => {\r\n            const status = allData.row.original.status;\r\n            if (\r\n              status === enums.COMPLETED ||\r\n              status === enums.STOCK_TRANSFER_COMPLETED ||\r\n              status === enums.STOCK_TRANSFER_PLACED ||\r\n              status === enums.CBO ||\r\n              status === enums.LOST_SALE\r\n            ) {\r\n              history.push(`${url}/${allData.value}/overview`);\r\n            } else if (status === enums.REQUEST_ORDER) {\r\n              history.push(`${url}/${allData.value}/request-order`);\r\n            } else if (status === enums.UPDATED) {\r\n              history.push(`${url}/${allData.value}/order-summary`);\r\n              /* history.push(`${url}/${allData.value}/request-order`); */\r\n            } else {\r\n              history.push(`${url}/${allData.value}`);\r\n            }\r\n          };\r\n\r\n          return (\r\n            <Menu>\r\n              <MenuButton p={0} as={Button}>\r\n                <Center>\r\n                  <FiMoreVertical />\r\n                </Center>\r\n              </MenuButton>\r\n\r\n              <MenuList onClick={handleViewOrderDetails}>\r\n                <MenuItem>View Detail</MenuItem>\r\n              </MenuList>\r\n            </Menu>\r\n          );\r\n        },\r\n      },\r\n    ],\r\n    [],\r\n  );\r\n\r\n  const handleSelectChange = (valueList, name) => {\r\n    const valueString = stringifyArray(valueList);\r\n    const statusString = stringifyArray(orderStatus);\r\n    const workshopString = stringifyArray(workshopValue);\r\n    const branchString = stringifyArray(branchValue);\r\n    const dateString = stringifyArray([dates.startDate, dates.endDate]);\r\n\r\n    if (name === enums.STATUS) {\r\n      setOrderStatus(valueList);\r\n      fetchAllOrders({\r\n        status: valueString,\r\n        order: orderIds,\r\n        workshop: workshopString,\r\n        branch: branchString,\r\n        date: dateString,\r\n\r\n      });\r\n    } else if (name === enums.WORKSHOP) {\r\n      setWorkshopValue(valueList);\r\n      fetchAllOrders({\r\n        workshop: valueString,\r\n        order: orderIds,\r\n        branch: branchString,\r\n        status: statusString,\r\n        date: dateString,\r\n\r\n      });\r\n    } else if (name === enums.BRANCH) {\r\n      setBranchValue(valueList);\r\n      fetchAllOrders({\r\n        branch: valueString,\r\n        order: orderIds,\r\n        workshop: workshopString,\r\n        status: statusString,\r\n        date: dateString,\r\n\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleSearchById = (event) => {\r\n    const idString = event.target.value;\r\n    const statusString = stringifyArray(orderStatus);\r\n    const workshopString = stringifyArray(workshopValue);\r\n    const branchString = stringifyArray(branchValue);\r\n    const dateString = stringifyArray([dates.startDate, dates.endDate]);\r\n\r\n    setOrdIds(idString);\r\n    fetchAllOrders({\r\n      status: statusString,\r\n      order: idString,\r\n      workshop: workshopString,\r\n      branch: branchString,\r\n      date: dateString,\r\n\r\n    });\r\n  };\r\n\r\n  /* once workshop is implemented, this list will be replaced with fetched workshops */\r\n  const workshopOptions = workshops.map((workshop) => ({\r\n    label: workshop?.name,\r\n    value: workshop?._id,\r\n  }));\r\n\r\n  const branchOptions = branches.map((branch) => ({\r\n    label: branch.branchName,\r\n    value: branch._id,\r\n  }));\r\n\r\n  const checkIsBefore = (date1, date2) => {\r\n    return moment(date1).isBefore(date2);\r\n  };\r\n\r\n  const addToDate = (date, days) => {\r\n    return moment(date, 'YYYY-MM-DD').add(days, 'days').format('YYYY-MM-DD');\r\n  };\r\n\r\n  function subtractFromDate(date, days) {\r\n    return moment(date, 'YYYY-MM-DD')\r\n      .subtract(days, 'days')\r\n      .format('YYYY-MM-DD');\r\n  }\r\n\r\n  const handleExport = () => {\r\n    const refinedTableData = [...tableData].map((data) => {\r\n      return {\r\n        'Date': data.date,\r\n        'Order No': data.orderNo,\r\n        'Workshop Code': data.workshopcustomer[0].code,\r\n        'Workshop Name': data.workshopcustomer[0].name,\r\n        'Branch Code': data.branchCode,\r\n        'Total Parts': data.orderitems.length(),\r\n        'Order Value': data.orderValue,\r\n        'Payment Mode': data.paymentOption,\r\n        'Order Status': data.orderStatus.join(','),\r\n      };\r\n    });\r\n    downloadExcel(refinedTableData, 'Branches.xlsx');\r\n  };\r\n\r\n  const handleDateChange = (event) => {\r\n    let dateString;\r\n\r\n    let { value, name } = event.target;\r\n\r\n    const statusString = stringifyArray(orderStatus);\r\n    const workshopString = stringifyArray(workshopValue);\r\n    const branchString = stringifyArray(branchValue);\r\n\r\n    if (name === enums.STARTDATE && value) {\r\n      const endDate = dates.endDate ? dates.endDate : addToDate(value, 1);\r\n\r\n      if (!checkIsBefore(value, endDate)) {\r\n        notification({\r\n          status: 'error',\r\n          description: intl.formatMessage(messages.dateError),\r\n        });\r\n        return;\r\n      } else {\r\n        dateString = stringifyArray([value, endDate]);\r\n      }\r\n    }\r\n\r\n    if (name === enums.ENDDATE && value) {\r\n      const startDate = dates.startDate\r\n        ? dates.startDate\r\n        : subtractFromDate(value, 1);\r\n\r\n      if (checkIsBefore(value, startDate)) {\r\n        notification({\r\n          status: 'error',\r\n          description: intl.formatMessage(messages.dateError),\r\n        });\r\n      } else {\r\n        dateString = stringifyArray([startDate, value]);\r\n      }\r\n    }\r\n\r\n    setDates((prevState) => ({ ...prevState, [name]: value }));\r\n    fetchAllOrders({\r\n      date: dateString,\r\n      status: statusString,\r\n      order: orderIds,\r\n      workshop: workshopString,\r\n      branch: branchString,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Switch>\r\n      <Route exact path={path}>\r\n        <div>\r\n          <TableTop\r\n            onSearchOrderChange={handleSearchById}\r\n            onSelectChange={handleSelectChange}\r\n            orderStatus={orderStatus}\r\n            workshopOptions={workshopOptions}\r\n            branchOptions={branchOptions}\r\n            branchValue={branchValue}\r\n            workshopValue={workshopValue}\r\n            onDateChange={handleDateChange}\r\n          />\r\n          <Button\r\n                  onClick={handleExport}\r\n                  variant='addition'\r\n                  size='md'\r\n                  ml={4}\r\n              >\r\n            {intl.formatMessage(messages.exportToExcel)}\r\n            </Button>    \r\n\r\n          <DynamicTable\r\n            columns={columns}\r\n            data={[...orders]}\r\n            fetchData={fetchAllOrders}\r\n            totalCount={totalCount}\r\n            controlledPageCount={pageCount}\r\n            loading={isLoading}\r\n            skipPageReset={true}\r\n            params={{ order: orderIds, status: stringifyArray(orderStatus), branch: stringifyArray(branchValue),workshop:stringifyArray(workshopValue), date:stringifyArray([dates.startDate, dates.endDate])   }}\r\n          />\r\n        </div>\r\n      </Route>\r\n      <Route exact path={`${path}/:id/overview`}>\r\n        <OrderOverview />\r\n      </Route>\r\n      <Route exact path={`${path}/:id/request-order`}>\r\n        <RequestOrder />\r\n      </Route>\r\n      <Route path={`${path}/:id`}>\r\n        <OrderDetails />\r\n      </Route>\r\n    </Switch>\r\n  );\r\n};\r\n\r\nexport default withToast(OrderList);\r\n"]},"metadata":{},"sourceType":"module"}