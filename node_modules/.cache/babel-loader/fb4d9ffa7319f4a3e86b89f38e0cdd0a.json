{"ast":null,"code":"import { Util } from './Util.js';\nimport { Animation } from './Animation.js';\nimport { Node } from './Node.js';\nimport { Konva } from './Global.js';\nvar blacklist = {\n  node: 1,\n  duration: 1,\n  easing: 1,\n  onFinish: 1,\n  yoyo: 1\n},\n    PAUSED = 1,\n    PLAYING = 2,\n    REVERSING = 3,\n    idCounter = 0,\n    colorAttrs = ['fill', 'stroke', 'shadowColor'];\n\nclass TweenEngine {\n  constructor(prop, propFunc, func, begin, finish, duration, yoyo) {\n    this.prop = prop;\n    this.propFunc = propFunc;\n    this.begin = begin;\n    this._pos = begin;\n    this.duration = duration;\n    this._change = 0;\n    this.prevPos = 0;\n    this.yoyo = yoyo;\n    this._time = 0;\n    this._position = 0;\n    this._startTime = 0;\n    this._finish = 0;\n    this.func = func;\n    this._change = finish - this.begin;\n    this.pause();\n  }\n\n  fire(str) {\n    var handler = this[str];\n\n    if (handler) {\n      handler();\n    }\n  }\n\n  setTime(t) {\n    if (t > this.duration) {\n      if (this.yoyo) {\n        this._time = this.duration;\n        this.reverse();\n      } else {\n        this.finish();\n      }\n    } else if (t < 0) {\n      if (this.yoyo) {\n        this._time = 0;\n        this.play();\n      } else {\n        this.reset();\n      }\n    } else {\n      this._time = t;\n      this.update();\n    }\n  }\n\n  getTime() {\n    return this._time;\n  }\n\n  setPosition(p) {\n    this.prevPos = this._pos;\n    this.propFunc(p);\n    this._pos = p;\n  }\n\n  getPosition(t) {\n    if (t === undefined) {\n      t = this._time;\n    }\n\n    return this.func(t, this.begin, this._change, this.duration);\n  }\n\n  play() {\n    this.state = PLAYING;\n    this._startTime = this.getTimer() - this._time;\n    this.onEnterFrame();\n    this.fire('onPlay');\n  }\n\n  reverse() {\n    this.state = REVERSING;\n    this._time = this.duration - this._time;\n    this._startTime = this.getTimer() - this._time;\n    this.onEnterFrame();\n    this.fire('onReverse');\n  }\n\n  seek(t) {\n    this.pause();\n    this._time = t;\n    this.update();\n    this.fire('onSeek');\n  }\n\n  reset() {\n    this.pause();\n    this._time = 0;\n    this.update();\n    this.fire('onReset');\n  }\n\n  finish() {\n    this.pause();\n    this._time = this.duration;\n    this.update();\n    this.fire('onFinish');\n  }\n\n  update() {\n    this.setPosition(this.getPosition(this._time));\n    this.fire('onUpdate');\n  }\n\n  onEnterFrame() {\n    var t = this.getTimer() - this._startTime;\n\n    if (this.state === PLAYING) {\n      this.setTime(t);\n    } else if (this.state === REVERSING) {\n      this.setTime(this.duration - t);\n    }\n  }\n\n  pause() {\n    this.state = PAUSED;\n    this.fire('onPause');\n  }\n\n  getTimer() {\n    return new Date().getTime();\n  }\n\n}\n\nexport class Tween {\n  constructor(config) {\n    var that = this,\n        node = config.node,\n        nodeId = node._id,\n        duration,\n        easing = config.easing || Easings.Linear,\n        yoyo = !!config.yoyo,\n        key;\n\n    if (typeof config.duration === 'undefined') {\n      duration = 0.3;\n    } else if (config.duration === 0) {\n      duration = 0.001;\n    } else {\n      duration = config.duration;\n    }\n\n    this.node = node;\n    this._id = idCounter++;\n    var layers = node.getLayer() || (node instanceof Konva['Stage'] ? node.getLayers() : null);\n\n    if (!layers) {\n      Util.error('Tween constructor have `node` that is not in a layer. Please add node into layer first.');\n    }\n\n    this.anim = new Animation(function () {\n      that.tween.onEnterFrame();\n    }, layers);\n    this.tween = new TweenEngine(key, function (i) {\n      that._tweenFunc(i);\n    }, easing, 0, 1, duration * 1000, yoyo);\n\n    this._addListeners();\n\n    if (!Tween.attrs[nodeId]) {\n      Tween.attrs[nodeId] = {};\n    }\n\n    if (!Tween.attrs[nodeId][this._id]) {\n      Tween.attrs[nodeId][this._id] = {};\n    }\n\n    if (!Tween.tweens[nodeId]) {\n      Tween.tweens[nodeId] = {};\n    }\n\n    for (key in config) {\n      if (blacklist[key] === undefined) {\n        this._addAttr(key, config[key]);\n      }\n    }\n\n    this.reset();\n    this.onFinish = config.onFinish;\n    this.onReset = config.onReset;\n    this.onUpdate = config.onUpdate;\n  }\n\n  _addAttr(key, end) {\n    var node = this.node,\n        nodeId = node._id,\n        start,\n        diff,\n        tweenId,\n        n,\n        len,\n        trueEnd,\n        trueStart,\n        endRGBA;\n    tweenId = Tween.tweens[nodeId][key];\n\n    if (tweenId) {\n      delete Tween.attrs[nodeId][tweenId][key];\n    }\n\n    start = node.getAttr(key);\n\n    if (Util._isArray(end)) {\n      diff = [];\n      len = Math.max(end.length, start.length);\n\n      if (key === 'points' && end.length !== start.length) {\n        if (end.length > start.length) {\n          trueStart = start;\n          start = Util._prepareArrayForTween(start, end, node.closed());\n        } else {\n          trueEnd = end;\n          end = Util._prepareArrayForTween(end, start, node.closed());\n        }\n      }\n\n      if (key.indexOf('fill') === 0) {\n        for (n = 0; n < len; n++) {\n          if (n % 2 === 0) {\n            diff.push(end[n] - start[n]);\n          } else {\n            var startRGBA = Util.colorToRGBA(start[n]);\n            endRGBA = Util.colorToRGBA(end[n]);\n            start[n] = startRGBA;\n            diff.push({\n              r: endRGBA.r - startRGBA.r,\n              g: endRGBA.g - startRGBA.g,\n              b: endRGBA.b - startRGBA.b,\n              a: endRGBA.a - startRGBA.a\n            });\n          }\n        }\n      } else {\n        for (n = 0; n < len; n++) {\n          diff.push(end[n] - start[n]);\n        }\n      }\n    } else if (colorAttrs.indexOf(key) !== -1) {\n      start = Util.colorToRGBA(start);\n      endRGBA = Util.colorToRGBA(end);\n      diff = {\n        r: endRGBA.r - start.r,\n        g: endRGBA.g - start.g,\n        b: endRGBA.b - start.b,\n        a: endRGBA.a - start.a\n      };\n    } else {\n      diff = end - start;\n    }\n\n    Tween.attrs[nodeId][this._id][key] = {\n      start: start,\n      diff: diff,\n      end: end,\n      trueEnd: trueEnd,\n      trueStart: trueStart\n    };\n    Tween.tweens[nodeId][key] = this._id;\n  }\n\n  _tweenFunc(i) {\n    var node = this.node,\n        attrs = Tween.attrs[node._id][this._id],\n        key,\n        attr,\n        start,\n        diff,\n        newVal,\n        n,\n        len,\n        end;\n\n    for (key in attrs) {\n      attr = attrs[key];\n      start = attr.start;\n      diff = attr.diff;\n      end = attr.end;\n\n      if (Util._isArray(start)) {\n        newVal = [];\n        len = Math.max(start.length, end.length);\n\n        if (key.indexOf('fill') === 0) {\n          for (n = 0; n < len; n++) {\n            if (n % 2 === 0) {\n              newVal.push((start[n] || 0) + diff[n] * i);\n            } else {\n              newVal.push('rgba(' + Math.round(start[n].r + diff[n].r * i) + ',' + Math.round(start[n].g + diff[n].g * i) + ',' + Math.round(start[n].b + diff[n].b * i) + ',' + (start[n].a + diff[n].a * i) + ')');\n            }\n          }\n        } else {\n          for (n = 0; n < len; n++) {\n            newVal.push((start[n] || 0) + diff[n] * i);\n          }\n        }\n      } else if (colorAttrs.indexOf(key) !== -1) {\n        newVal = 'rgba(' + Math.round(start.r + diff.r * i) + ',' + Math.round(start.g + diff.g * i) + ',' + Math.round(start.b + diff.b * i) + ',' + (start.a + diff.a * i) + ')';\n      } else {\n        newVal = start + diff * i;\n      }\n\n      node.setAttr(key, newVal);\n    }\n  }\n\n  _addListeners() {\n    this.tween.onPlay = () => {\n      this.anim.start();\n    };\n\n    this.tween.onReverse = () => {\n      this.anim.start();\n    };\n\n    this.tween.onPause = () => {\n      this.anim.stop();\n    };\n\n    this.tween.onFinish = () => {\n      var node = this.node;\n      var attrs = Tween.attrs[node._id][this._id];\n\n      if (attrs.points && attrs.points.trueEnd) {\n        node.setAttr('points', attrs.points.trueEnd);\n      }\n\n      if (this.onFinish) {\n        this.onFinish.call(this);\n      }\n    };\n\n    this.tween.onReset = () => {\n      var node = this.node;\n      var attrs = Tween.attrs[node._id][this._id];\n\n      if (attrs.points && attrs.points.trueStart) {\n        node.points(attrs.points.trueStart);\n      }\n\n      if (this.onReset) {\n        this.onReset();\n      }\n    };\n\n    this.tween.onUpdate = () => {\n      if (this.onUpdate) {\n        this.onUpdate.call(this);\n      }\n    };\n  }\n\n  play() {\n    this.tween.play();\n    return this;\n  }\n\n  reverse() {\n    this.tween.reverse();\n    return this;\n  }\n\n  reset() {\n    this.tween.reset();\n    return this;\n  }\n\n  seek(t) {\n    this.tween.seek(t * 1000);\n    return this;\n  }\n\n  pause() {\n    this.tween.pause();\n    return this;\n  }\n\n  finish() {\n    this.tween.finish();\n    return this;\n  }\n\n  destroy() {\n    var nodeId = this.node._id,\n        thisId = this._id,\n        attrs = Tween.tweens[nodeId],\n        key;\n    this.pause();\n\n    for (key in attrs) {\n      delete Tween.tweens[nodeId][key];\n    }\n\n    delete Tween.attrs[nodeId][thisId];\n  }\n\n}\nTween.attrs = {};\nTween.tweens = {};\n\nNode.prototype.to = function (params) {\n  var onFinish = params.onFinish;\n  params.node = this;\n\n  params.onFinish = function () {\n    this.destroy();\n\n    if (onFinish) {\n      onFinish();\n    }\n  };\n\n  var tween = new Tween(params);\n  tween.play();\n};\n\nexport const Easings = {\n  BackEaseIn(t, b, c, d) {\n    var s = 1.70158;\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  },\n\n  BackEaseOut(t, b, c, d) {\n    var s = 1.70158;\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  },\n\n  BackEaseInOut(t, b, c, d) {\n    var s = 1.70158;\n\n    if ((t /= d / 2) < 1) {\n      return c / 2 * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n    }\n\n    return c / 2 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n  },\n\n  ElasticEaseIn(t, b, c, d, a, p) {\n    var s = 0;\n\n    if (t === 0) {\n      return b;\n    }\n\n    if ((t /= d) === 1) {\n      return b + c;\n    }\n\n    if (!p) {\n      p = d * 0.3;\n    }\n\n    if (!a || a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = p / (2 * Math.PI) * Math.asin(c / a);\n    }\n\n    return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n  },\n\n  ElasticEaseOut(t, b, c, d, a, p) {\n    var s = 0;\n\n    if (t === 0) {\n      return b;\n    }\n\n    if ((t /= d) === 1) {\n      return b + c;\n    }\n\n    if (!p) {\n      p = d * 0.3;\n    }\n\n    if (!a || a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = p / (2 * Math.PI) * Math.asin(c / a);\n    }\n\n    return a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b;\n  },\n\n  ElasticEaseInOut(t, b, c, d, a, p) {\n    var s = 0;\n\n    if (t === 0) {\n      return b;\n    }\n\n    if ((t /= d / 2) === 2) {\n      return b + c;\n    }\n\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n\n    if (!a || a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    } else {\n      s = p / (2 * Math.PI) * Math.asin(c / a);\n    }\n\n    if (t < 1) {\n      return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n    }\n\n    return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;\n  },\n\n  BounceEaseOut(t, b, c, d) {\n    if ((t /= d) < 1 / 2.75) {\n      return c * (7.5625 * t * t) + b;\n    } else if (t < 2 / 2.75) {\n      return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\n    } else if (t < 2.5 / 2.75) {\n      return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\n    } else {\n      return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\n    }\n  },\n\n  BounceEaseIn(t, b, c, d) {\n    return c - Easings.BounceEaseOut(d - t, 0, c, d) + b;\n  },\n\n  BounceEaseInOut(t, b, c, d) {\n    if (t < d / 2) {\n      return Easings.BounceEaseIn(t * 2, 0, c, d) * 0.5 + b;\n    } else {\n      return Easings.BounceEaseOut(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n    }\n  },\n\n  EaseIn(t, b, c, d) {\n    return c * (t /= d) * t + b;\n  },\n\n  EaseOut(t, b, c, d) {\n    return -c * (t /= d) * (t - 2) + b;\n  },\n\n  EaseInOut(t, b, c, d) {\n    if ((t /= d / 2) < 1) {\n      return c / 2 * t * t + b;\n    }\n\n    return -c / 2 * (--t * (t - 2) - 1) + b;\n  },\n\n  StrongEaseIn(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  },\n\n  StrongEaseOut(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  },\n\n  StrongEaseInOut(t, b, c, d) {\n    if ((t /= d / 2) < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  },\n\n  Linear(t, b, c, d) {\n    return c * t / d + b;\n  }\n\n};","map":{"version":3,"sources":["../src/Tween.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { Util } from './Util.js';\nimport { Animation } from './Animation.js';\nimport { Node } from './Node.js';\nimport { Konva } from './Global.js';\nvar blacklist = {\n    node: 1,\n    duration: 1,\n    easing: 1,\n    onFinish: 1,\n    yoyo: 1,\n}, PAUSED = 1, PLAYING = 2, REVERSING = 3, idCounter = 0, colorAttrs = ['fill', 'stroke', 'shadowColor'];\nclass TweenEngine {\n    constructor(prop, propFunc, func, begin, finish, duration, yoyo) {\n        this.prop = prop;\n        this.propFunc = propFunc;\n        this.begin = begin;\n        this._pos = begin;\n        this.duration = duration;\n        this._change = 0;\n        this.prevPos = 0;\n        this.yoyo = yoyo;\n        this._time = 0;\n        this._position = 0;\n        this._startTime = 0;\n        this._finish = 0;\n        this.func = func;\n        this._change = finish - this.begin;\n        this.pause();\n    }\n    fire(str) {\n        var handler = this[str];\n        if (handler) {\n            handler();\n        }\n    }\n    setTime(t) {\n        if (t > this.duration) {\n            if (this.yoyo) {\n                this._time = this.duration;\n                this.reverse();\n            }\n            else {\n                this.finish();\n            }\n        }\n        else if (t < 0) {\n            if (this.yoyo) {\n                this._time = 0;\n                this.play();\n            }\n            else {\n                this.reset();\n            }\n        }\n        else {\n            this._time = t;\n            this.update();\n        }\n    }\n    getTime() {\n        return this._time;\n    }\n    setPosition(p) {\n        this.prevPos = this._pos;\n        this.propFunc(p);\n        this._pos = p;\n    }\n    getPosition(t) {\n        if (t === undefined) {\n            t = this._time;\n        }\n        return this.func(t, this.begin, this._change, this.duration);\n    }\n    play() {\n        this.state = PLAYING;\n        this._startTime = this.getTimer() - this._time;\n        this.onEnterFrame();\n        this.fire('onPlay');\n    }\n    reverse() {\n        this.state = REVERSING;\n        this._time = this.duration - this._time;\n        this._startTime = this.getTimer() - this._time;\n        this.onEnterFrame();\n        this.fire('onReverse');\n    }\n    seek(t) {\n        this.pause();\n        this._time = t;\n        this.update();\n        this.fire('onSeek');\n    }\n    reset() {\n        this.pause();\n        this._time = 0;\n        this.update();\n        this.fire('onReset');\n    }\n    finish() {\n        this.pause();\n        this._time = this.duration;\n        this.update();\n        this.fire('onFinish');\n    }\n    update() {\n        this.setPosition(this.getPosition(this._time));\n        this.fire('onUpdate');\n    }\n    onEnterFrame() {\n        var t = this.getTimer() - this._startTime;\n        if (this.state === PLAYING) {\n            this.setTime(t);\n        }\n        else if (this.state === REVERSING) {\n            this.setTime(this.duration - t);\n        }\n    }\n    pause() {\n        this.state = PAUSED;\n        this.fire('onPause');\n    }\n    getTimer() {\n        return new Date().getTime();\n    }\n}\nexport class Tween {\n    constructor(config) {\n        var that = this, node = config.node, nodeId = node._id, duration, easing = config.easing || Easings.Linear, yoyo = !!config.yoyo, key;\n        if (typeof config.duration === 'undefined') {\n            duration = 0.3;\n        }\n        else if (config.duration === 0) {\n            duration = 0.001;\n        }\n        else {\n            duration = config.duration;\n        }\n        this.node = node;\n        this._id = idCounter++;\n        var layers = node.getLayer() ||\n            (node instanceof Konva['Stage'] ? node.getLayers() : null);\n        if (!layers) {\n            Util.error('Tween constructor have `node` that is not in a layer. Please add node into layer first.');\n        }\n        this.anim = new Animation(function () {\n            that.tween.onEnterFrame();\n        }, layers);\n        this.tween = new TweenEngine(key, function (i) {\n            that._tweenFunc(i);\n        }, easing, 0, 1, duration * 1000, yoyo);\n        this._addListeners();\n        if (!Tween.attrs[nodeId]) {\n            Tween.attrs[nodeId] = {};\n        }\n        if (!Tween.attrs[nodeId][this._id]) {\n            Tween.attrs[nodeId][this._id] = {};\n        }\n        if (!Tween.tweens[nodeId]) {\n            Tween.tweens[nodeId] = {};\n        }\n        for (key in config) {\n            if (blacklist[key] === undefined) {\n                this._addAttr(key, config[key]);\n            }\n        }\n        this.reset();\n        this.onFinish = config.onFinish;\n        this.onReset = config.onReset;\n        this.onUpdate = config.onUpdate;\n    }\n    _addAttr(key, end) {\n        var node = this.node, nodeId = node._id, start, diff, tweenId, n, len, trueEnd, trueStart, endRGBA;\n        tweenId = Tween.tweens[nodeId][key];\n        if (tweenId) {\n            delete Tween.attrs[nodeId][tweenId][key];\n        }\n        start = node.getAttr(key);\n        if (Util._isArray(end)) {\n            diff = [];\n            len = Math.max(end.length, start.length);\n            if (key === 'points' && end.length !== start.length) {\n                if (end.length > start.length) {\n                    trueStart = start;\n                    start = Util._prepareArrayForTween(start, end, node.closed());\n                }\n                else {\n                    trueEnd = end;\n                    end = Util._prepareArrayForTween(end, start, node.closed());\n                }\n            }\n            if (key.indexOf('fill') === 0) {\n                for (n = 0; n < len; n++) {\n                    if (n % 2 === 0) {\n                        diff.push(end[n] - start[n]);\n                    }\n                    else {\n                        var startRGBA = Util.colorToRGBA(start[n]);\n                        endRGBA = Util.colorToRGBA(end[n]);\n                        start[n] = startRGBA;\n                        diff.push({\n                            r: endRGBA.r - startRGBA.r,\n                            g: endRGBA.g - startRGBA.g,\n                            b: endRGBA.b - startRGBA.b,\n                            a: endRGBA.a - startRGBA.a,\n                        });\n                    }\n                }\n            }\n            else {\n                for (n = 0; n < len; n++) {\n                    diff.push(end[n] - start[n]);\n                }\n            }\n        }\n        else if (colorAttrs.indexOf(key) !== -1) {\n            start = Util.colorToRGBA(start);\n            endRGBA = Util.colorToRGBA(end);\n            diff = {\n                r: endRGBA.r - start.r,\n                g: endRGBA.g - start.g,\n                b: endRGBA.b - start.b,\n                a: endRGBA.a - start.a,\n            };\n        }\n        else {\n            diff = end - start;\n        }\n        Tween.attrs[nodeId][this._id][key] = {\n            start: start,\n            diff: diff,\n            end: end,\n            trueEnd: trueEnd,\n            trueStart: trueStart,\n        };\n        Tween.tweens[nodeId][key] = this._id;\n    }\n    _tweenFunc(i) {\n        var node = this.node, attrs = Tween.attrs[node._id][this._id], key, attr, start, diff, newVal, n, len, end;\n        for (key in attrs) {\n            attr = attrs[key];\n            start = attr.start;\n            diff = attr.diff;\n            end = attr.end;\n            if (Util._isArray(start)) {\n                newVal = [];\n                len = Math.max(start.length, end.length);\n                if (key.indexOf('fill') === 0) {\n                    for (n = 0; n < len; n++) {\n                        if (n % 2 === 0) {\n                            newVal.push((start[n] || 0) + diff[n] * i);\n                        }\n                        else {\n                            newVal.push('rgba(' +\n                                Math.round(start[n].r + diff[n].r * i) +\n                                ',' +\n                                Math.round(start[n].g + diff[n].g * i) +\n                                ',' +\n                                Math.round(start[n].b + diff[n].b * i) +\n                                ',' +\n                                (start[n].a + diff[n].a * i) +\n                                ')');\n                        }\n                    }\n                }\n                else {\n                    for (n = 0; n < len; n++) {\n                        newVal.push((start[n] || 0) + diff[n] * i);\n                    }\n                }\n            }\n            else if (colorAttrs.indexOf(key) !== -1) {\n                newVal =\n                    'rgba(' +\n                        Math.round(start.r + diff.r * i) +\n                        ',' +\n                        Math.round(start.g + diff.g * i) +\n                        ',' +\n                        Math.round(start.b + diff.b * i) +\n                        ',' +\n                        (start.a + diff.a * i) +\n                        ')';\n            }\n            else {\n                newVal = start + diff * i;\n            }\n            node.setAttr(key, newVal);\n        }\n    }\n    _addListeners() {\n        this.tween.onPlay = () => {\n            this.anim.start();\n        };\n        this.tween.onReverse = () => {\n            this.anim.start();\n        };\n        this.tween.onPause = () => {\n            this.anim.stop();\n        };\n        this.tween.onFinish = () => {\n            var node = this.node;\n            var attrs = Tween.attrs[node._id][this._id];\n            if (attrs.points && attrs.points.trueEnd) {\n                node.setAttr('points', attrs.points.trueEnd);\n            }\n            if (this.onFinish) {\n                this.onFinish.call(this);\n            }\n        };\n        this.tween.onReset = () => {\n            var node = this.node;\n            var attrs = Tween.attrs[node._id][this._id];\n            if (attrs.points && attrs.points.trueStart) {\n                node.points(attrs.points.trueStart);\n            }\n            if (this.onReset) {\n                this.onReset();\n            }\n        };\n        this.tween.onUpdate = () => {\n            if (this.onUpdate) {\n                this.onUpdate.call(this);\n            }\n        };\n    }\n    play() {\n        this.tween.play();\n        return this;\n    }\n    reverse() {\n        this.tween.reverse();\n        return this;\n    }\n    reset() {\n        this.tween.reset();\n        return this;\n    }\n    seek(t) {\n        this.tween.seek(t * 1000);\n        return this;\n    }\n    pause() {\n        this.tween.pause();\n        return this;\n    }\n    finish() {\n        this.tween.finish();\n        return this;\n    }\n    destroy() {\n        var nodeId = this.node._id, thisId = this._id, attrs = Tween.tweens[nodeId], key;\n        this.pause();\n        for (key in attrs) {\n            delete Tween.tweens[nodeId][key];\n        }\n        delete Tween.attrs[nodeId][thisId];\n    }\n}\nTween.attrs = {};\nTween.tweens = {};\nNode.prototype.to = function (params) {\n    var onFinish = params.onFinish;\n    params.node = this;\n    params.onFinish = function () {\n        this.destroy();\n        if (onFinish) {\n            onFinish();\n        }\n    };\n    var tween = new Tween(params);\n    tween.play();\n};\nexport const Easings = {\n    BackEaseIn(t, b, c, d) {\n        var s = 1.70158;\n        return c * (t /= d) * t * ((s + 1) * t - s) + b;\n    },\n    BackEaseOut(t, b, c, d) {\n        var s = 1.70158;\n        return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n    },\n    BackEaseInOut(t, b, c, d) {\n        var s = 1.70158;\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n        }\n        return (c / 2) * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n    },\n    ElasticEaseIn(t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d) === 1) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * 0.3;\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        return (-(a *\n            Math.pow(2, 10 * (t -= 1)) *\n            Math.sin(((t * d - s) * (2 * Math.PI)) / p)) + b);\n    },\n    ElasticEaseOut(t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d) === 1) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * 0.3;\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        return (a * Math.pow(2, -10 * t) * Math.sin(((t * d - s) * (2 * Math.PI)) / p) +\n            c +\n            b);\n    },\n    ElasticEaseInOut(t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d / 2) === 2) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * (0.3 * 1.5);\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        if (t < 1) {\n            return (-0.5 *\n                (a *\n                    Math.pow(2, 10 * (t -= 1)) *\n                    Math.sin(((t * d - s) * (2 * Math.PI)) / p)) +\n                b);\n        }\n        return (a *\n            Math.pow(2, -10 * (t -= 1)) *\n            Math.sin(((t * d - s) * (2 * Math.PI)) / p) *\n            0.5 +\n            c +\n            b);\n    },\n    BounceEaseOut(t, b, c, d) {\n        if ((t /= d) < 1 / 2.75) {\n            return c * (7.5625 * t * t) + b;\n        }\n        else if (t < 2 / 2.75) {\n            return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\n        }\n        else if (t < 2.5 / 2.75) {\n            return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\n        }\n        else {\n            return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\n        }\n    },\n    BounceEaseIn(t, b, c, d) {\n        return c - Easings.BounceEaseOut(d - t, 0, c, d) + b;\n    },\n    BounceEaseInOut(t, b, c, d) {\n        if (t < d / 2) {\n            return Easings.BounceEaseIn(t * 2, 0, c, d) * 0.5 + b;\n        }\n        else {\n            return Easings.BounceEaseOut(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n        }\n    },\n    EaseIn(t, b, c, d) {\n        return c * (t /= d) * t + b;\n    },\n    EaseOut(t, b, c, d) {\n        return -c * (t /= d) * (t - 2) + b;\n    },\n    EaseInOut(t, b, c, d) {\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * t * t + b;\n        }\n        return (-c / 2) * (--t * (t - 2) - 1) + b;\n    },\n    StrongEaseIn(t, b, c, d) {\n        return c * (t /= d) * t * t * t * t + b;\n    },\n    StrongEaseOut(t, b, c, d) {\n        return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n    },\n    StrongEaseInOut(t, b, c, d) {\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * t * t * t * t * t + b;\n        }\n        return (c / 2) * ((t -= 2) * t * t * t * t + 2) + b;\n    },\n    Linear(t, b, c, d) {\n        return (c * t) / d + b;\n    },\n};\n//# sourceMappingURL=Tween.js.map"]},"metadata":{},"sourceType":"module"}