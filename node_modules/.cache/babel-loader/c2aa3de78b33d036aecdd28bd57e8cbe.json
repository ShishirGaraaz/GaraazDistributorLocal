{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Desktop\\\\Work\\\\garaaz-distributor\\\\src\\\\containers\\\\OrderDetails\\\\OrderSummary.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useMemo, useEffect, useState, useRef } from 'react';\nimport { Box, Button, Menu, MenuButton, MenuList, MenuItem } from '@chakra-ui/react';\nimport { ChevronDownIcon } from '@chakra-ui/icons';\nimport DynamicTable from '../../components/DynamicTable';\nimport Layout from '../Layout';\nimport { MdOutlineAirplaneTicket } from 'react-icons/md';\nimport { FaFileInvoice } from 'react-icons/fa';\nimport { FiDownload } from 'react-icons/fi';\nimport { OrderDetailInfo } from '../../components/OrderComponents/OrderDetailInfo';\nimport { useIntl } from 'react-intl';\nimport messages from './messages';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { BackButton } from '../../components/BackButton';\nimport { updateOrders } from './actions';\nimport { getOrderDetails, setOrderDetails } from './actions';\nimport routes from '../../routes';\nimport withToast from '../../HOCs/withToast';\nimport { useHistory } from 'react-router';\nimport enums from '../../utils/enums';\nimport OrderInvoice from './Invoice';\nimport ReactToPrint from 'react-to-print';\nimport getMoneyFormat from '../../utils/getMoneyFormat';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const OrderSummary = withToast(_c = _s(_ref => {\n  _s();\n\n  let {\n    goToUnavilable,\n    notification\n  } = _ref;\n  const intl = useIntl();\n  const {\n    orderDetails\n  } = useSelector(state => state.orderDetails);\n  const [partList, setPartList] = useState([]);\n  const [totals, setTotals] = useState([{\n    totalOrderedQuantity: 0,\n    totalQuantityToGive: 0,\n    totalAmount: 0,\n    partList: ''\n  }]);\n  const auth = useSelector(state => state.auth);\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const [displayInvoice, setInvoice] = useState(false);\n  const orderSummaryRef = useRef();\n\n  const fetchOrderDetails = async () => {\n    try {\n      const data = await getOrderDetails(auth, orderDetails._id);\n      dispatch(setOrderDetails(data));\n    } catch (error) {\n      notification({\n        status: 'error',\n        description: error.response ? error.response.data.message : intl.formatMessage(messages.errorOccurred)\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (localStorage.orderSummary !== undefined) {\n      setTotals([JSON.parse(localStorage.orderSummary)]);\n    }\n\n    if (localStorage.partList !== undefined) {\n      setPartList(JSON.parse(localStorage.partList));\n    }\n  }, []);\n  const columns = useMemo(() => [{\n    Header: intl.formatMessage(messages.SNo),\n    accessor: 'SNo',\n    Cell: allData => {\n      var _allData$row;\n\n      return /*#__PURE__*/_jsxDEV(Box, {\n        children: (allData === null || allData === void 0 ? void 0 : (_allData$row = allData.row) === null || _allData$row === void 0 ? void 0 : _allData$row.index) + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 18\n      }, this);\n    }\n  }, {\n    Header: intl.formatMessage(messages.partNumber),\n    accessor: row => row.part.partNumber\n  }, {\n    Header: intl.formatMessage(messages.partDescription),\n    accessor: row => row.part.description\n  }, {\n    Header: intl.formatMessage(messages.quantityOrdered),\n    accessor: 'quantity'\n  }, {\n    Header: intl.formatMessage(messages.availableQuantity),\n    accessor: 'availableQuantity'\n  }, {\n    Header: intl.formatMessage(messages.quantityToGive),\n    accessor: 'quantityToGive'\n  }, {\n    Header: intl.formatMessage(messages.pricePerPiece),\n    accessor: 'price',\n    Cell: _ref2 => {\n      let {\n        value\n      } = _ref2;\n      return getMoneyFormat(value);\n    }\n  }, {\n    Header: intl.formatMessage(messages.totalAmount),\n    accessor: 'totalAmount',\n    Cell: _ref3 => {\n      let {\n        value\n      } = _ref3;\n      return getMoneyFormat(value);\n    }\n  }], []);\n  const actionButton = [{\n    name: intl.formatMessage(messages.pickTicket),\n    icon: /*#__PURE__*/_jsxDEV(MdOutlineAirplaneTicket, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }, this),\n    type: ''\n  }, {\n    name: intl.formatMessage(messages.invoice),\n    icon: /*#__PURE__*/_jsxDEV(FaFileInvoice, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 57\n    }, this)\n  }, {\n    name: intl.formatMessage(messages.excelCsv),\n    icon: /*#__PURE__*/_jsxDEV(FiDownload, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 58\n    }, this)\n  }];\n\n  const handleCompleteOrder = async () => {\n    try {\n      const updatedParts = {\n        status: enums.COMPLETED\n      };\n      await updateOrders({\n        auth,\n        orderId: orderDetails._id,\n        data: updatedParts\n      });\n      fetchOrderDetails();\n      notification({\n        status: 'success',\n        title: intl.formatMessage(messages.orderCompleted),\n        description: intl.formatMessage(messages.orderCompletedDescription)\n      });\n\n      if (JSON.parse(localStorage.partsUnavailable).length > 0) {\n        goToUnavilable();\n      } else {\n        history.push('/orders');\n      }\n    } catch (error) {\n      notification({\n        status: 'error',\n        description: intl.formatMessage(messages.errorOccurred)\n      });\n    }\n  };\n\n  const handleExport = exportType => {\n    window.open(`${process.env.REACT_APP_BASE_URL}${routes.orderRoute}/${orderDetails._id}/export?option=${exportType}`, '_blank');\n  };\n\n  const handleTopButtonClick = name => {\n    if (name === intl.formatMessage(messages.invoice)) {\n      setInvoice(true);\n    }\n\n    if (name === intl.formatMessage(messages.pickTicket)) {\n      window.open(`${process.env.REACT_APP_BASE_URL}${routes.orderRoute}/${orderDetails._id}/export?option=txt`, '_blank');\n    }\n  };\n\n  const topActionButtons = actionButton.map(item => {\n    if (item.name === intl.formatMessage(messages.excelCsv)) {\n      return /*#__PURE__*/_jsxDEV(Menu, {\n        children: [/*#__PURE__*/_jsxDEV(MenuButton, {\n          ml: 3,\n          my: 4,\n          as: Button,\n          rightIcon: /*#__PURE__*/_jsxDEV(ChevronDownIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 60\n          }, this),\n          children: item.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MenuList, {\n          children: [/*#__PURE__*/_jsxDEV(ReactToPrint, {\n            trigger: () => {\n              return /*#__PURE__*/_jsxDEV(MenuItem, {\n                children: intl.formatMessage(messages.downloadPDF)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 19\n              }, this);\n            },\n            content: () => orderSummaryRef.current\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n            onClick: () => handleExport('csv'),\n            children: intl.formatMessage(messages.downloadCSV)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this)]\n      }, item.name, true, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(Button, {\n      onClick: () => handleTopButtonClick(item.name),\n      ml: 3,\n      leftIcon: item.icon,\n      my: 4,\n      children: item.name\n    }, item.name, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this);\n  });\n\n  if (displayInvoice) {\n    return /*#__PURE__*/_jsxDEV(InvoiceComponent, {\n      handleAfterPrice: () => setInvoice(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 12\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      children: [/*#__PURE__*/_jsxDEV(BackButton, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n        children: topActionButtons\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OrderDetailInfo, {\n      orderDetails: orderDetails\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      ref: orderSummaryRef,\n      children: /*#__PURE__*/_jsxDEV(DynamicTable, {\n        hidePagination: true,\n        columns: columns,\n        totals: totals[0],\n        data: partList,\n        fetchData: data => 'fetch Data here'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      onClick: handleCompleteOrder,\n      variant: \"normal\",\n      my: 4,\n      marginLeft: \"auto\",\n      children: intl.formatMessage(messages.completeOrderContinue)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}, \"z0rPpjBl1TR4cmV0I1HHqcYlJMI=\", false, function () {\n  return [useIntl, useSelector, useSelector, useDispatch, useHistory];\n}));\n_c2 = OrderSummary;\nexport const InvoiceComponent = props => {\n  _s2();\n\n  const invoiceRef = useRef();\n  return /*#__PURE__*/_jsxDEV(Box, {\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      p: 3,\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      children: [/*#__PURE__*/_jsxDEV(BackButton, {\n        onClick: props.handleAfterPrice\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ReactToPrint, {\n        trigger: () => {\n          //setInvoice(true)\n          // NOTE: could just as easily return <SomeComponent />. Do NOT pass an `onClick` prop\n          // to the root node of the returned component as it will be overwritten.\n          return /*#__PURE__*/_jsxDEV(Button, {\n            ml: 3,\n            variant: \"normal\",\n            leftIcon: /*#__PURE__*/_jsxDEV(FaFileInvoice, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 27\n            }, this),\n            my: 4,\n            children: \"Print Invoice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 15\n          }, this);\n        },\n        content: () => invoiceRef.current,\n        onAfterPrint: props.handleAfterPrice\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OrderInvoice, {\n      ref: invoiceRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 260,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(InvoiceComponent, \"BO7mcibeZm/eKwpk5xAk+V4wRIM=\");\n\n_c3 = InvoiceComponent;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"OrderSummary$withToast\");\n$RefreshReg$(_c2, \"OrderSummary\");\n$RefreshReg$(_c3, \"InvoiceComponent\");","map":{"version":3,"sources":["C:/Users/Acer/Desktop/Work/garaaz-distributor/src/containers/OrderDetails/OrderSummary.js"],"names":["React","useMemo","useEffect","useState","useRef","Box","Button","Menu","MenuButton","MenuList","MenuItem","ChevronDownIcon","DynamicTable","Layout","MdOutlineAirplaneTicket","FaFileInvoice","FiDownload","OrderDetailInfo","useIntl","messages","useSelector","useDispatch","BackButton","updateOrders","getOrderDetails","setOrderDetails","routes","withToast","useHistory","enums","OrderInvoice","ReactToPrint","getMoneyFormat","OrderSummary","goToUnavilable","notification","intl","orderDetails","state","partList","setPartList","totals","setTotals","totalOrderedQuantity","totalQuantityToGive","totalAmount","auth","dispatch","history","displayInvoice","setInvoice","orderSummaryRef","fetchOrderDetails","data","_id","error","status","description","response","message","formatMessage","errorOccurred","localStorage","orderSummary","undefined","JSON","parse","columns","Header","SNo","accessor","Cell","allData","row","index","partNumber","part","partDescription","quantityOrdered","availableQuantity","quantityToGive","pricePerPiece","value","actionButton","name","pickTicket","icon","type","invoice","excelCsv","handleCompleteOrder","updatedParts","COMPLETED","orderId","title","orderCompleted","orderCompletedDescription","partsUnavailable","length","push","handleExport","exportType","window","open","process","env","REACT_APP_BASE_URL","orderRoute","handleTopButtonClick","topActionButtons","map","item","downloadPDF","current","downloadCSV","completeOrderContinue","InvoiceComponent","props","invoiceRef","handleAfterPrice"],"mappings":"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","sourcesContent":["import React, { useMemo, useEffect, useState, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Button,\r\n  Menu,\r\n  MenuButton,\r\n  MenuList,\r\n  MenuItem,\r\n} from '@chakra-ui/react';\r\nimport { ChevronDownIcon } from '@chakra-ui/icons';\r\nimport DynamicTable from '../../components/DynamicTable';\r\nimport Layout from '../Layout';\r\nimport { MdOutlineAirplaneTicket } from 'react-icons/md';\r\nimport { FaFileInvoice } from 'react-icons/fa';\r\nimport { FiDownload } from 'react-icons/fi';\r\nimport { OrderDetailInfo } from '../../components/OrderComponents/OrderDetailInfo';\r\nimport { useIntl } from 'react-intl';\r\nimport messages from './messages';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { BackButton } from '../../components/BackButton';\r\nimport {updateOrders } from './actions';\r\nimport { getOrderDetails, setOrderDetails } from './actions';\r\nimport routes from '../../routes';\r\nimport withToast from '../../HOCs/withToast';\r\nimport { useHistory } from 'react-router';\r\nimport enums from '../../utils/enums';\r\nimport OrderInvoice from './Invoice';\r\nimport ReactToPrint from 'react-to-print';\r\nimport getMoneyFormat from '../../utils/getMoneyFormat';\r\n\r\nexport const OrderSummary = withToast(({ goToUnavilable, notification }) => {\r\n  const intl = useIntl();\r\n  const { orderDetails } = useSelector((state) => state.orderDetails);\r\n  const [partList, setPartList] = useState([]);\r\n  const [totals, setTotals] = useState([\r\n    {\r\n      totalOrderedQuantity: 0,\r\n      totalQuantityToGive: 0,\r\n      totalAmount: 0,\r\n      partList: '',\r\n    },\r\n  ]);\r\n  const auth = useSelector((state) => state.auth);\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n  const [displayInvoice, setInvoice] = useState(false);\r\n\r\n  const orderSummaryRef = useRef();\r\n  const fetchOrderDetails = async () => {\r\n    try {\r\n      const data = await getOrderDetails(auth, orderDetails._id);\r\n      dispatch(setOrderDetails(data));\r\n    } catch (error) {\r\n      notification({\r\n        status: 'error',\r\n        description: error.response\r\n          ? error.response.data.message\r\n          : intl.formatMessage(messages.errorOccurred),\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (localStorage.orderSummary !== undefined) {\r\n      setTotals([JSON.parse(localStorage.orderSummary)]);\r\n    }\r\n\r\n    if (localStorage.partList !== undefined) {\r\n      setPartList(JSON.parse(localStorage.partList));\r\n    }\r\n  }, []);\r\n\r\n\r\n\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        Header: intl.formatMessage(messages.SNo),\r\n        accessor: 'SNo',\r\n        Cell: (allData) => {\r\n          return <Box>{allData?.row?.index + 1}</Box>;\r\n        },\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.partNumber),\r\n        accessor: (row) => row.part.partNumber,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.partDescription),\r\n        accessor: (row) => row.part.description,\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.quantityOrdered),\r\n        accessor: 'quantity',\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.availableQuantity),\r\n        accessor: 'availableQuantity',\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.quantityToGive),\r\n        accessor: 'quantityToGive',\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.pricePerPiece),\r\n        accessor: 'price',\r\n        Cell: ({value}) => getMoneyFormat(value)\r\n      },\r\n      {\r\n        Header: intl.formatMessage(messages.totalAmount),\r\n        accessor: 'totalAmount',\r\n        Cell: ({value}) => getMoneyFormat(value)\r\n      },\r\n    ],\r\n    [],\r\n  );\r\n\r\n  const actionButton = [\r\n    {\r\n      name: intl.formatMessage(messages.pickTicket),\r\n      icon: <MdOutlineAirplaneTicket />,\r\n      type: '',\r\n    },\r\n    { name: intl.formatMessage(messages.invoice), icon: <FaFileInvoice /> },\r\n    { name: intl.formatMessage(messages.excelCsv), icon: <FiDownload /> },\r\n  ];\r\n\r\n  const handleCompleteOrder = async () => {\r\n    try {\r\n      const updatedParts = {\r\n        status: enums.COMPLETED,\r\n      };\r\n\r\n      await updateOrders({\r\n        auth,\r\n        orderId: orderDetails._id,\r\n        data: updatedParts,\r\n      });\r\n      fetchOrderDetails();\r\n      notification({\r\n        status: 'success',\r\n        title: intl.formatMessage(messages.orderCompleted),\r\n        description: intl.formatMessage(messages.orderCompletedDescription),\r\n      });\r\n      if (JSON.parse(localStorage.partsUnavailable).length > 0) {\r\n        goToUnavilable();\r\n      } else {\r\n        history.push('/orders');\r\n      }\r\n    } catch (error) {\r\n      notification({\r\n        status: 'error',\r\n        description: intl.formatMessage(messages.errorOccurred),\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleExport = (exportType) => {\r\n    window.open(\r\n      `${process.env.REACT_APP_BASE_URL}${routes.orderRoute}/${orderDetails._id}/export?option=${exportType}`,\r\n      '_blank',\r\n    );\r\n  };\r\n\r\n  const handleTopButtonClick = (name) => {\r\n    if (name === intl.formatMessage(messages.invoice)) {\r\n      setInvoice(true);\r\n    }\r\n\r\n    if(name === intl.formatMessage(messages.pickTicket) ){\r\n      window.open(\r\n        `${process.env.REACT_APP_BASE_URL}${routes.orderRoute}/${orderDetails._id}/export?option=txt`,\r\n        '_blank',\r\n      );\r\n    }\r\n  };\r\n\r\n\r\n  const topActionButtons = actionButton.map((item) => {\r\n    if (item.name === intl.formatMessage(messages.excelCsv)) {\r\n      return (\r\n        <Menu key={item.name}>\r\n          <MenuButton ml={3} my={4} as={Button} rightIcon={<ChevronDownIcon />}>\r\n            {item.name}\r\n          </MenuButton>\r\n          <MenuList>\r\n            <ReactToPrint\r\n              trigger={() => {\r\n                return (\r\n                  <MenuItem>\r\n                    {intl.formatMessage(messages.downloadPDF)}\r\n                  </MenuItem>\r\n                );\r\n              }}\r\n              content={() => orderSummaryRef.current}\r\n            />\r\n\r\n            <MenuItem onClick={() => handleExport('csv')}>\r\n              {intl.formatMessage(messages.downloadCSV)}\r\n            </MenuItem>\r\n            {/* <MenuItem onClick={() => handleExport('txt')}>\r\n              {intl.formatMessage(messages.downloadDOC)}\r\n            </MenuItem> */}\r\n          </MenuList>\r\n        </Menu>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Button\r\n        key={item.name}\r\n        onClick={() => handleTopButtonClick(item.name)}\r\n        ml={3}\r\n        leftIcon={item.icon}\r\n        my={4}\r\n      >\r\n        {item.name}\r\n      </Button>\r\n    );\r\n  });\r\n\r\n  if (displayInvoice) {\r\n    return <InvoiceComponent handleAfterPrice={() => setInvoice(false)} />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Box display='flex' justifyContent='space-between' alignItems='center'>\r\n        <BackButton />\r\n        <Box display='flex' justifyContent='flex-end'>\r\n          {topActionButtons}\r\n        </Box>\r\n      </Box>\r\n      <OrderDetailInfo orderDetails={orderDetails} />\r\n      <Box ref={orderSummaryRef}>\r\n        <DynamicTable\r\n          hidePagination={true}\r\n          columns={columns}\r\n          totals={totals[0]}\r\n          data={partList}\r\n          fetchData={(data) => 'fetch Data here'}\r\n        />\r\n      </Box>\r\n      <Button\r\n        onClick={handleCompleteOrder}\r\n        variant='normal'\r\n        my={4}\r\n        marginLeft='auto'\r\n      >\r\n        {intl.formatMessage(messages.completeOrderContinue)}\r\n      </Button>\r\n    </>\r\n  );\r\n});\r\n\r\nexport const InvoiceComponent = (props) => {\r\n  const invoiceRef = useRef();\r\n\r\n  return (\r\n    <Box>\r\n      <Box\r\n        p={3}\r\n        display='flex'\r\n        justifyContent='space-between'\r\n        alignItems='center'\r\n      >\r\n        <BackButton onClick={props.handleAfterPrice} />\r\n        <ReactToPrint\r\n          trigger={() => {\r\n            //setInvoice(true)\r\n            // NOTE: could just as easily return <SomeComponent />. Do NOT pass an `onClick` prop\r\n            // to the root node of the returned component as it will be overwritten.\r\n            return (\r\n              <Button\r\n                ml={3}\r\n                variant='normal'\r\n                leftIcon={<FaFileInvoice />}\r\n                my={4}\r\n              >\r\n                Print Invoice\r\n              </Button>\r\n            );\r\n          }}\r\n          content={() => invoiceRef.current}\r\n          onAfterPrint={props.handleAfterPrice}\r\n        />\r\n      </Box>\r\n      <OrderInvoice ref={invoiceRef} />\r\n    </Box>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}